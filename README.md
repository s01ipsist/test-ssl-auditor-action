# test-ssl-auditor-action

GitHub Action to audit testssl.sh JSON results against configurable security rules.

This action is designed to work with the outputs generated by [test-ssl-action](https://github.com/s01ipsist/test-ssl-action).

## Features

- üîç Audit testssl.sh JSON output files
- üìã Configurable security rules
- ‚öôÔ∏è Flexible rule configuration (JSON)
- üìä Detailed violation reporting
- ‚úÖ Pass/fail control

## Usage

### Basic Usage

```yaml
name: SSL Audit
on: [push]

jobs:
  test-and-audit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Test SSL/TLS
        uses: s01ipsist/test-ssl-action@main
        with:
          uri: 'https://example.com/'
      
      - name: Audit SSL Results
        uses: s01ipsist/test-ssl-auditor-action@main
        with:
          results-path: 'testssl_results_*.json'
          rules-config: '.testssl-rules.json'
          fail-on-violation: 'true'
```

### Complete Workflow with Multiple Sites

```yaml
name: SSL Test and Audit
on: [push]

jobs:
  ssl-security:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        uri:
          - 'https://example.com/'
          - 'https://api.example.com/'
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Test SSL/TLS for ${{ matrix.uri }}
        uses: s01ipsist/test-ssl-action@main
        with:
          uri: ${{ matrix.uri }}
      
      - name: Audit SSL Results
        uses: s01ipsist/test-ssl-auditor-action@main
        with:
          results-path: 'testssl_results_*.json'
          fail-on-violation: 'true'
      
      - name: Upload results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ssl-results-${{ strategy.job-index }}
          path: testssl_results_*.json
```

Note: [Job Matrix has a Limit of 256 jobs / workflow run](https://docs.github.com/en/actions/reference/limits)

## Inputs

| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| `results-path` | Path or glob pattern to testssl.sh JSON result files | Yes | `testssl_results_*.json` |
| `rules-config` | Path to rules configuration file (JSON) | No | `.testssl-rules.json` |
| `fail-on-violation` | Whether to fail the action if rule violations are found | No | `true` |

## Outputs

| Output | Description |
|--------|-------------|
| `violations-found` | Whether any rule violations were found (`true`/`false`) |
| `violation-count` | Number of rule violations found |
| `summary` | Summary of the audit results |

## Rules Configuration

Create a `.testssl-rules.json` file in your repository to configure audit rules:

```json
{
  "rules": {
    "minTlsVersion": "1.2",
    "allowedCiphers": [],
    "blockedCiphers": [
      "RC4",
      "DES",
      "3DES",
      "NULL",
      "EXPORT",
      "anon",
      "MD5"
    ],
    "requireForwardSecrecy": true,
    "maxCertificateExpiry": 14,
    "minGrade": "B"
  }
}
```

### Available Rules

- **minTlsVersion**: Minimum TLS version required (e.g., "1.2", "1.3"). The action checks if any insecure TLS versions are offered, including handling findings like "offered", "offered (deprecated)", "not offered", and "not offered + downgraded to weaker protocol".
- **allowedCiphers**: List of explicitly allowed cipher patterns (empty = all allowed)
- **blockedCiphers**: List of blocked cipher patterns that should not be offered (e.g., "RC4", "DES", "3DES")
- **requireForwardSecrecy**: Require forward secrecy (PFS) support
- **maxCertificateExpiry**: Maximum days until certificate expiry
- **minGrade**: Minimum overall grade required from testssl.sh (e.g., "A+", "A", "A-", "B", "C", "D", "E", "F", "T"). Grades are compared hierarchically where A+ is the best and T (trust issues, e.g., expired certificate) is the worst. If the actual grade is below the minimum, a violation is reported.

## Examples

See the [examples](./examples) directory for complete workflow examples.

## License

MIT

## Related Projects

- [test-ssl-action](https://github.com/s01ipsist/test-ssl-action) - GitHub Action to run testssl.sh
- [testssl.sh](https://testssl.sh/) - Testing TLS/SSL encryption
